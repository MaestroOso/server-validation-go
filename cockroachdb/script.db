CREATE USER IF NOT EXISTS ocastelblanco;

CREATE DATABASE IF NOT EXISTS server;

GRANT ALL ON DATABASE server TO ocastelblanco;

use server;

CREATE TABLE IF NOT EXISTS DOMAIN (
  id SERIAL PRIMARY KEY,
  host VARCHAR(255) NOT NULL,
  ssl_grade VARCHAR(8) NOT NULL,
  is_down BOOLEAN DEFAULT false,
);

CREATE TABLE IF NOT EXISTS DOMAINCONSULT (
  id SERIAL PRIMARY KEY,
  id_domain INT REFERENCES DOMAIN(id) ON UPDATE CASCADE ON DELETE CASCADE,
  consult_time TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  ssl_grade VARCHAR(8) NOT NULL,
  title VARCHAR(255),
  logo VARCHAR(511),
  is_down BOOLEAN DEFAULT false
);

CREATE TABLE IF NOT EXISTS SERVER (
  id SERIAL PRIMARY KEY,
  id_domainconsult INT REFERENCES DOMAINCONSULT(id) ON UPDATE CASCADE ON DELETE CASCADE,
  address VARCHAR(255) NOT NULL,
  ssl_grade VARCHAR(8) NOT NULL,
  country VARCHAR(50) NOT NULL,
  owner VARCHAR(50) NOT NULL
);
